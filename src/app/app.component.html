<mat-sidenav-container [hasBackdrop]="false" class="container">

  <mat-sidenav-content>

    <mat-toolbar color="primary">
      <button mat-flat-button color="primary" class="menu-button" (click)="sidenav.toggle()">
        <mat-icon>menu</mat-icon>
      </button>
      <span>{{ chatManager && chatManager.chat().target().name || 'NgWebIRC' }}</span>
    </mat-toolbar>
<!--
    <mat-tab-group animationDuration="0ms" (selectedTabChange)="chatManager.show(chatList[$event.index])">
      <mat-tab *ngFor="let c of chatList" label="{{c}}"
               matBadge="8" matBadgePosition="after" matBadgeColor="accent"></mat-tab>
    </mat-tab-group>
-->
    <app-chat-manager
      (chatOpen)="onChatOpen($event)" #chatManager></app-chat-manager>

  </mat-sidenav-content>

  <mat-sidenav #sidenav mode="side" opened="true || sidenav.mode == 'side'" position="end">

    <div class="toolbar-buttons" fxLayout="row" fxLayoutAlign="end center">
      <!--
      <button *ngIf="chatManager && chatManager.chat().hasUsers()" mat-icon-button (click)="showUserList = true">
        <mat-icon aria-label="Conversation List">group</mat-icon>
      </button>
      -->
      <button mat-icon-button (click)="showChatList()" [disabled]="!showUserList">
        <mat-icon aria-label="Conversation List">people_alt</mat-icon>
      </button>
    </div>

    <div class="conversations-list" *ngIf="!showUserList" fxAlign="stretch">
      <div *ngFor="let chat of chatList">
        <div class="chat-button">
          <button *ngIf="chat.stats.messages.new === 0; else button_indicator"
                  (click)="onChannelButtonClick(sidenav, chat)"
                  mat-stroked-button
                  [color]="chat === chatManager.chat() ? 'accent': ''">
            {{chat.target().name}}
          </button>
          <ng-template #button_indicator>
            <button (click)="onChannelButtonClick(sidenav, chat)"
                    mat-stroked-button
                    [color]="chat === chatManager.chat() ? 'accent': ''"
                    [matBadge]="chat.stats.messages.new"
                    matBadgePosition="after" matBadgeColor="accent">
              {{chat.target().name}}
            </button>
          </ng-template>
        </div>
      </div>
    </div>

    <div class="users-list" *ngIf="showUserList" fxAlign="stretch">
      <div *ngFor="let u of chatManager.chat().users"
           fxLayout="column" fxAlignColumn="stretch">
        <button mat-button (click)="onUserClick(userMenu, u)" [matMenuTriggerFor]="userMenu">{{u}}</button>
      </div>
      <mat-menu #userMenu="matMenu" xPosition="after">
        <div class="user-menu-title">{{currentUser}}</div>
        <button mat-menu-item (click)="onUserMenuChat()">
          <mat-icon>message</mat-icon>
          <span>Chat</span>
        </button>
        <button mat-menu-item disabled>
          <mat-icon>voicemail</mat-icon>
          <span>Check voicemail</span>
        </button>
        <button mat-menu-item>
          <mat-icon>notifications_off</mat-icon>
          <span>Disable alerts</span>
        </button>
      </mat-menu>
    </div>

  </mat-sidenav>

</mat-sidenav-container>


