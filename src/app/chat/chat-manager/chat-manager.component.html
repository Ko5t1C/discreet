<div class="container" fxFlexFill fxLayout="row" fxLayoutAlign="stretch stretch">

  <app-messages-window
    #messageWindow
    (sendMessage)="onSendMessage($event)"></app-messages-window>

  <div class="conversations-list" *ngIf="!showUserList">
    <div class="chat-button" *ngFor="let c of boundChatList | sortBy:'desc':'timestamp'">
      <button mat-raised-button (click)="onChannelButtonClick(c)"
              [color]="c === chat() ? 'accent': ''"
              [matBadge]="c.stats.messages.new"
              [matBadgeHidden]="c.stats.messages.new === 0"
              matBadgePosition="after" matBadgeColor="accent"
              fxLayout="row" fxLayoutAlign="start center">
        <mat-icon [color]="getColor(c)" [innerText]="getIcon(c)"></mat-icon>
        <span>{{c.target().name}}</span>
      </button>
    </div>
    <!--
    <div *ngFor="let media of mediaUrlsCache">{{ media.title }}</div>
    -->
  </div>

  <div class="users-list" *ngIf="showUserList"
       fxLayout="column" fxLayoutAlign="stretch stretch">
    <cdk-virtual-scroll-viewport *ngIf="chat().hasUsers()" class="v-scroll" itemSize="40" minBufferPx="200" maxBufferPx="400">
      <button mat-button
              *cdkVirtualFor="let u of chat().users"
              (click)="onUserClick(userMenu, u)"
              [matMenuTriggerFor]="userMenu"
              fxLayout="row" fxLayoutAlign="start center">
        <mat-icon [color]="u.color" [innerText]="u.icon"></mat-icon>
        <span [innerText]="u.name"></span>
      </button>
    </cdk-virtual-scroll-viewport>
    <!--
    <div *ngFor="let u of chat().users"
         fxLayout="column" fxLayoutAlign="stretch stretch">
      <button mat-button
              (click)="onUserClick(userMenu, u)"
              [matMenuTriggerFor]="userMenu"
              fxLayout="row" fxLayoutAlign="start center">
        <mat-icon [color]="u.color" [innerText]="u.icon"></mat-icon>
        <span [innerText]="u.name"></span>
      </button>
    </div>
    -->
    <mat-menu #userMenu="matMenu" xPosition="after">
      <div class="user-menu-title" *ngIf="currentUser">{{currentUser.name}}</div>
      <button mat-menu-item (click)="onUserMenuChat()">
        <mat-icon>message</mat-icon>
        <span>Chat</span>
      </button>
      <button mat-menu-item disabled>
        <mat-icon>voicemail</mat-icon>
        <span>Check voicemail</span>
      </button>
      <button mat-menu-item disabled>
        <mat-icon>notifications_on</mat-icon>
        <span>Enable alerts</span>
      </button>
    </mat-menu>
  </div>

</div>

<div class="input-bar" fxLayout="row" fxLayoutAlign="start stretch" fxLayoutGap="8px">

  <mat-form-field fxFlexAlign="stretch">
    <input matInput placeholder="Enter message" class="message-input"
           [(ngModel)]="userMessage"
           (keydown.enter)="onEnterKey($event)">
  </mat-form-field>

  <!--div>
    <emoji-mart (emojiClick)="onAddEmoji($event.emoji)"
                title="Pick your emojiâ€¦" emoji="point_up"
                set="google"
                hideObsolete="true"
                skin="3"></emoji-mart>
  </div-->

  <div class="action-buttons">
    <button mat-fab>
      <mat-icon>group</mat-icon>
    </button>
    <button mat-fab>
      <mat-icon>send_message</mat-icon>
    </button>
  </div>

</div>

<div class="loading-message" *ngIf="false && isLoadingChat" fxLayout="column" fxLayoutAlign="center center">
  <mat-spinner>Loading</mat-spinner>
</div>
